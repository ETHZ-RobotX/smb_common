<?xml version="1.0"?>

<!-- This file contains plugins to simulate an Imu sensor attached to the robot. -->
<!-- Documentation can be found at http://wiki.ros.org/hector_gazebo_plugins -->

<robot name="smb" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- INCLUDE PLUGIN -->
  <xacro:include filename="$(find smb_description)/urdf/sensor_plugins/smb_blackfly_stereo.gazebo.xacro"/>


  <xacro:macro name="rgbcamera_cam_stereo" params="base_link simulation">
    <!--                              Camera  Properties 				          	-->
    <xacro:property name="rgbcamera_base_link"		value="${base_link}"/>
    <xacro:property name="rgbcamera_left_origin_rpy"		value="0 0 0"/>
    <xacro:property name="rgbcamera_left_origin_xyz"		value="0.29082 0.04458 ${0.0955 + chassisHeight/2.0}"/>
    <xacro:property name="rgbcamera_right_origin_rpy"		value="0 0 0"/>
    <xacro:property name="rgbcamera_right_origin_xyz"		value="0.29082 -0.04542 ${0.0955 + chassisHeight/2.0}"/>

    <xacro:property name="rgbcamera_update_rate"		value="30"/>
    <xacro:property name="rgbcamera_left_link"  		value="rgbcamera_left_link"/>
    <xacro:property name="rgbcamera_right_link"  	value="rgbcamera_right_link"/>
    <xacro:property name="rgbcamera_left_topic" 		value="/rgbcamera/left/image_raw"/>
    <xacro:property name="rgbcamera_right_topic" 	value="/rgbcamera/right/image_raw"/>


    <link name="${rgbcamera_left_link}">
      <inertial>
        <mass value="0.01" /> <!-- [kg] -->
        <inertia ixx="1e-5" ixy="0" ixz="0" iyy="1e-5" iyz="0" izz="1e-5"/>
      </inertial>
      <visual>
        <geometry>
          <mesh filename="package://smb_description/urdf/new_payload/meshes/SMB_blackfly_camera.dae"/>
        </geometry>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://smb_description/urdf/new_payload/meshes/SMB_blackfly_camera.dae"/>
        </geometry>
      </collision>
      <material name="red">
          <color rgba="255 0 10 255"/>
        </material>
    </link>

      <gazebo reference="${rgbcamera_left_link}">
        <material>Gazebo/Red</material>
      </gazebo>

    <link name="${rgbcamera_right_link}">
      <inertial>
        <mass value="0.01" /> <!-- [kg] -->
        <inertia ixx="1e-5" ixy="0" ixz="0" iyy="1e-5" iyz="0" izz="1e-5"/>
      </inertial>
      <visual>
        <geometry>
          <mesh filename="package://smb_description/urdf/new_payload/meshes/SMB_blackfly_camera.dae"/>
        </geometry>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://smb_description/urdf/new_payload/meshes/SMB_blackfly_camera.dae"/>
        </geometry>
      </collision>
      <material name="red">
          <color rgba="255 0 10 255"/>
        </material>
    </link>

    <gazebo reference="${rgbcamera_right_link}">
        <material>Gazebo/Red</material>
      </gazebo>

    <joint name="rgbcamera_left_camera_joint" type="fixed">
      <origin xyz="${rgbcamera_left_origin_xyz}" rpy="${rgbcamera_left_origin_rpy}"/>
      <parent link="${rgbcamera_base_link}"/>
      <child link="${rgbcamera_left_link}"/>
    </joint>

      <gazebo reference="rgbcamera_left_camera_joint">
        <disableFixedJointLumping>true</disableFixedJointLumping>
      </gazebo>

    <joint name="rgbcamera_right_camera_joint" type="fixed">
      <origin xyz="${rgbcamera_right_origin_xyz}" rpy="${rgbcamera_right_origin_rpy}"/>
      <parent link="${rgbcamera_base_link}"/>
      <child link="${rgbcamera_right_link}"/>
    </joint>

      <gazebo reference="rgbcamera_right_camera_joint">
        <disableFixedJointLumping>true</disableFixedJointLumping>
      </gazebo>

    <link name="rgbcamera_left_optical_link"/>

    <link name="rgbcamera_right_optical_link"/>

    <joint name="rgbcamera_left_camera_optical_joint" type="fixed">
      <origin xyz="0.0066 0 0" rpy="-1.57 0 -1.57"/>
      <parent link="${rgbcamera_left_link}"/>
      <child link="rgbcamera_left_optical_link"/>
    </joint>

    <joint name="rgbcamera_right_camera_optical_joint" type="fixed">
      <origin xyz="0.0066 0 0" rpy="-1.57 0 -1.57"/>
      <parent link="${rgbcamera_right_link}"/>
      <child link="rgbcamera_right_optical_link"/>
    </joint>

    <xacro:if value="${simulation}">
        <xacro:rgbcamera_camera_stereo_plugin name="rgbcamera" rate="${rgbcamera_update_rate}"/>
    </xacro:if>


  </xacro:macro>
</robot>
